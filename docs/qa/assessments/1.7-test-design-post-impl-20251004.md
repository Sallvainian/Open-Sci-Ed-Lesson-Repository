# Test Design: Story 1.7 - Hosting and Production Environment Setup

**Date:** 2025-10-04
**Designer:** Quinn (Test Architect)
**Story Status:** Draft (Pre-Implementation Design)

## Test Strategy Overview

- **Total Test Scenarios:** 42
- **Unit Tests:** 4 (10%)
- **Integration Tests:** 18 (43%)
- **E2E Tests:** 20 (47%)
- **Priority Distribution:**
  - P0 (Critical): 15 scenarios (36%)
  - P1 (High): 18 scenarios (43%)
  - P2 (Medium): 7 scenarios (17%)
  - P3 (Low): 2 scenarios (5%)

**Testing Philosophy:**
Infrastructure deployment story requires E2E-heavy testing. Unit tests limited to health check logic. Integration tests focus on component connectivity. E2E tests validate full deployment workflow.

**Rationale for E2E Emphasis:**

- Infrastructure configuration not unit-testable
- Deployment verification requires real environment
- Manual verification is primary testing method (AC requirements)
- Existing 68 unit/integration tests from Stories 1.1-1.5 run in CI

---

## Test Scenarios by Acceptance Criteria

### AC1: Hosting platform selected and configured (Vercel)

**Infrastructure Setup:** Vercel, GitHub Integration

| ID          | Level       | Priority | Scenario                                | Justification                      | Risk Coverage     |
| ----------- | ----------- | -------- | --------------------------------------- | ---------------------------------- | ----------------- |
| 1.7-E2E-001 | E2E         | P0       | Vercel account creation and GitHub link | Critical deployment foundation     | OPS-001           |
| 1.7-INT-001 | Integration | P0       | `vercel.json` configuration validation  | Incorrect config blocks deployment | OPS-001, TECH-003 |
| 1.7-E2E-002 | E2E         | P1       | Automatic deployment from main branch   | Core CI/CD workflow                | OPS-001           |
| 1.7-E2E-003 | E2E         | P1       | Preview deployment from pull request    | Safe testing before production     | OPS-001           |
| 1.7-INT-002 | Integration | P1       | Production URL accessibility via HTTPS  | Deployment success verification    | SEC-003           |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-E2E-001
  Given Vercel account does not exist
  When I create Vercel account and link GitHub repository
  Then Vercel dashboard shows linked repository
  And Automatic deployments are enabled for main branch

Scenario: 1.7-INT-001
  Given vercel.json exists in project root
  When I validate configuration against Vercel schema
  Then All required fields are present (buildCommand, framework, env)
  And Environment variable references use @ prefix
```

---

### AC2: Database hosted on Supabase with PostgreSQL

**Infrastructure Setup:** Supabase PostgreSQL, Connection Pooling, Storage Bucket

| ID          | Level       | Priority | Scenario                                     | Justification                         | Risk Coverage     |
| ----------- | ----------- | -------- | -------------------------------------------- | ------------------------------------- | ----------------- |
| 1.7-E2E-004 | E2E         | P0       | Supabase project creation                    | Database foundation                   | DATA-001          |
| 1.7-INT-003 | Integration | P0       | Database connection string retrieval         | Application must connect              | TECH-001, SEC-001 |
| 1.7-INT-004 | Integration | P0       | Connection string uses pooler port 6543      | Serverless compatibility              | TECH-001          |
| 1.7-E2E-005 | E2E         | P0       | Storage bucket creation (`lesson-resources`) | File hosting requirement              | SEC-002           |
| 1.7-INT-005 | Integration | P0       | Storage bucket RLS policies configuration    | Security: public read, auth write     | SEC-002           |
| 1.7-E2E-006 | E2E         | P1       | Automatic daily backup schedule enabled      | Data protection (AC#9)                | DATA-002          |
| 1.7-INT-006 | Integration | P2       | Backup retention period verification         | Verify 7-day free tier or 30-day paid | DATA-002          |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-INT-003
  Given Supabase project created
  When I navigate to Settings → Database
  Then Connection string is visible
  And Pooler connection string uses port 6543

Scenario: 1.7-INT-005
  Given Storage bucket 'lesson-resources' created
  When I test unauthenticated read request
  Then Request succeeds (public read allowed)
  When I test unauthenticated write request
  Then Request fails 403 (authentication required)
```

---

### AC3: Production environment variables configured securely

**Security Critical:** Environment Secrets, Vercel Dashboard Configuration

| ID          | Level       | Priority | Scenario                                         | Justification                  | Risk Coverage     |
| ----------- | ----------- | -------- | ------------------------------------------------ | ------------------------------ | ----------------- |
| 1.7-E2E-007 | E2E         | P0       | `.env.local` exists in `.gitignore`              | Prevent secret exposure        | SEC-001           |
| 1.7-INT-007 | Integration | P0       | Git history scan for leaked secrets              | Security validation            | SEC-001           |
| 1.7-E2E-008 | E2E         | P0       | Vercel environment variables configured          | Required for app functionality | SEC-001, TECH-004 |
| 1.7-INT-008 | Integration | P0       | Secrets use @ prefix naming convention           | Vercel best practice           | SEC-001           |
| 1.7-E2E-009 | E2E         | P0       | Production secrets differ from dev secrets       | Environment isolation          | SEC-001           |
| 1.7-INT-009 | Integration | P1       | `SUPABASE_SERVICE_KEY` scoped to production only | Least privilege principle      | SEC-001           |
| 1.7-INT-010 | Integration | P2       | Environment variable spelling verification       | Typo prevention                | TECH-004          |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-E2E-007
  Given Project repository contains .gitignore
  When I check .gitignore contents
  Then .env.local is listed
  And .env*.local pattern is listed

Scenario: 1.7-E2E-008
  Given Supabase connection details available
  When I navigate to Vercel Dashboard → Environment Variables
  Then DATABASE_URL is configured as secret
  And NEXT_PUBLIC_SUPABASE_URL is configured
  And NEXT_PUBLIC_SUPABASE_ANON_KEY is configured
  And SUPABASE_SERVICE_KEY is configured
```

---

### AC4: Application accessible via HTTPS at stable URL

**Deployment Verification:** HTTPS, DNS, Certificate

| ID          | Level       | Priority | Scenario                                    | Justification            | Risk Coverage |
| ----------- | ----------- | -------- | ------------------------------------------- | ------------------------ | ------------- |
| 1.7-E2E-010 | E2E         | P0       | Production URL resolves to Vercel           | Core deployment success  | OPS-001       |
| 1.7-E2E-011 | E2E         | P0       | HTTPS certificate provisioned automatically | Security requirement     | SEC-003       |
| 1.7-INT-011 | Integration | P0       | Certificate valid and not expired           | SSL/TLS validation       | SEC-003       |
| 1.7-E2E-012 | E2E         | P1       | HTTP redirects to HTTPS automatically       | Security best practice   | SEC-003       |
| 1.7-INT-012 | Integration | P2       | Certificate issued by Vercel/Let's Encrypt  | Verify auto-provisioning | SEC-003       |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-E2E-010
  Given Vercel deployment completed
  When I navigate to https://<project>.vercel.app
  Then Page loads successfully
  And Browser shows padlock icon (secure connection)

Scenario: 1.7-E2E-011
  Given Production URL accessible
  When I check SSL certificate in browser
  Then Certificate is valid
  And Certificate is not expired
  And Certificate issuer is Vercel or Let's Encrypt
```

---

### AC5: Database migrations run successfully in production

**Data Operations:** Prisma Migrations, Seed Scripts

| ID          | Level       | Priority | Scenario                                      | Justification                     | Risk Coverage |
| ----------- | ----------- | -------- | --------------------------------------------- | --------------------------------- | ------------- |
| 1.7-INT-013 | Integration | P0       | Prisma client generation succeeds             | Required before migration         | DATA-001      |
| 1.7-E2E-013 | E2E         | P0       | Database migration dry-run on staging         | Risk mitigation: test before prod | DATA-001      |
| 1.7-E2E-014 | E2E         | P0       | Production migration executes successfully    | Core deployment step              | DATA-001      |
| 1.7-INT-014 | Integration | P0       | All tables created (disciplines, units, etc.) | Schema validation                 | DATA-001      |
| 1.7-E2E-015 | E2E         | P0       | Seed script executes without errors           | Initial data population           | DATA-003      |
| 1.7-INT-015 | Integration | P0       | Seed data inserted (3 disciplines, 1 unit)    | Data validation                   | DATA-003      |
| 1.7-INT-016 | Integration | P1       | Migration idempotency (safe to re-run)        | Rollback/retry capability         | DATA-001      |
| 1.7-INT-017 | Integration | P1       | Seed script idempotency (no duplicates)       | Multiple runs don't corrupt data  | DATA-003      |
| 1.7-E2E-016 | E2E         | P1       | Rollback procedure validation                 | Disaster recovery                 | DATA-001      |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-E2E-013
  Given Supabase staging environment exists
  And DATABASE_URL points to staging database
  When I run 'pnpm db:migrate'
  Then Migration completes successfully
  And No errors in output

Scenario: 1.7-E2E-014
  Given Staging migration succeeded
  And DATABASE_URL points to production database
  And Pre-migration backup created
  When I run 'pnpm db:migrate' in production
  Then Migration completes successfully
  And psql \dt shows all tables created

Scenario: 1.7-INT-017
  Given Seed script already executed once
  When I run 'pnpm db:seed' again
  Then No duplicate records created
  And Disciplines count remains 3
```

---

### AC6: Health check endpoint returns 200 OK

**API Endpoint:** `/api/health`

| ID           | Level       | Priority | Scenario                                | Justification                    | Risk Coverage |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------- | ------------- |
| 1.7-UNIT-001 | Unit        | P0       | Health check logic without database     | Isolate response structure       | PERF-001      |
| 1.7-INT-018  | Integration | P0       | Health check with database connection   | Database connectivity validation | PERF-001      |
| 1.7-E2E-017  | E2E         | P0       | Production health check returns 200     | Live endpoint verification       | PERF-001      |
| 1.7-UNIT-002 | Unit        | P1       | Health check timeout handling           | Error handling logic             | PERF-001      |
| 1.7-INT-019  | Integration | P1       | Health check with database unavailable  | Degraded state handling (503)    | PERF-001      |
| 1.7-E2E-018  | E2E         | P1       | Health check response time <2 seconds   | Performance requirement          | PERF-001      |
| 1.7-INT-020  | Integration | P2       | Health check response format validation | API contract compliance          | -             |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-UNIT-001
  Given Health check handler function
  When Database query succeeds
  Then Response is { status: 'healthy', timestamp, checks: { database: 'ok' } }
  And HTTP status code is 200

Scenario: 1.7-INT-019
  Given Health check endpoint deployed
  When Database connection fails
  Then Response is { status: 'unhealthy', timestamp, error }
  And HTTP status code is 503

Scenario: 1.7-E2E-017
  Given Production deployment complete
  When I curl https://<prod-url>.vercel.app/api/health
  Then HTTP status code is 200
  And Response contains status: 'healthy'
  And Response contains timestamp (ISO 8601 format)
```

---

### AC7: Frontend loads and displays login page in production

**Frontend Verification:** Page Load, DevTools, Performance

| ID          | Level       | Priority | Scenario                                      | Justification                       | Risk Coverage |
| ----------- | ----------- | -------- | --------------------------------------------- | ----------------------------------- | ------------- |
| 1.7-E2E-019 | E2E         | P0       | Production login page loads successfully      | Core user-facing functionality      | OPS-001       |
| 1.7-E2E-020 | E2E         | P0       | Browser DevTools console shows no errors      | Error-free deployment               | OPS-001       |
| 1.7-E2E-021 | E2E         | P0       | Static assets load from Vercel CDN (HTTP 200) | Asset delivery verification         | PERF-002      |
| 1.7-INT-021 | Integration | P1       | Page load time <3 seconds                     | Performance target (AC requirement) | PERF-002      |
| 1.7-E2E-022 | E2E         | P1       | CSS styling renders correctly                 | Visual validation                   | PERF-002      |
| 1.7-E2E-023 | E2E         | P1       | JavaScript bundles execute without errors     | Client-side functionality           | TECH-003      |
| 1.7-INT-022 | Integration | P2       | Fonts load from edge network                  | CDN performance                     | PERF-002      |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-E2E-019
  Given Production URL is https://<project>.vercel.app
  When I navigate to production URL in Chrome
  Then Login page displays
  And Page renders in <3 seconds

Scenario: 1.7-E2E-020
  Given Login page loaded
  When I open Chrome DevTools Console
  Then No errors are displayed
  And No warnings related to application code

Scenario: 1.7-E2E-021
  Given Login page loaded
  When I open Chrome DevTools Network tab
  Then All /_next/static/* files show HTTP 200
  And Assets served from Vercel edge network
```

---

### AC8: Backend API endpoints accessible from frontend (CORS)

**API Integration:** CORS Configuration, Same-Origin Policy

| ID          | Level       | Priority | Scenario                                          | Justification                     | Risk Coverage |
| ----------- | ----------- | -------- | ------------------------------------------------- | --------------------------------- | ------------- |
| 1.7-INT-023 | Integration | P0       | Frontend API call to /api/health succeeds         | Same-origin deployment validation | TECH-002      |
| 1.7-E2E-024 | E2E         | P0       | Browser console shows no CORS errors              | CORS configuration verification   | TECH-002      |
| 1.7-INT-024 | Integration | P1       | API response headers include correct CORS headers | Header validation                 | TECH-002      |
| 1.7-E2E-025 | E2E         | P1       | Database query from frontend executes             | Full-stack integration            | TECH-002      |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-INT-023
  Given Production frontend loaded in browser
  When I execute: fetch('/api/health').then(r => r.json())
  Then Request succeeds without CORS error
  And Response contains { status: 'healthy' }

Scenario: 1.7-E2E-024
  Given Production login page open
  And Chrome DevTools Console open
  When Page performs API calls during load
  Then No CORS-related errors appear
  And All API requests show HTTP 200 or expected status
```

---

### AC9: Automated daily backups configured

**Data Protection:** Backup Configuration, Verification

| ID          | Level       | Priority | Scenario                         | Justification                | Risk Coverage |
| ----------- | ----------- | -------- | -------------------------------- | ---------------------------- | ------------- |
| 1.7-E2E-026 | E2E         | P0       | Supabase backup schedule enabled | Data protection requirement  | DATA-002      |
| 1.7-INT-025 | Integration | P1       | Backup retention period verified | Backup policy validation     | DATA-002      |
| 1.7-E2E-027 | E2E         | P2       | Backup restoration dry-run       | Disaster recovery validation | DATA-002      |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-E2E-026
  Given Supabase production project configured
  When I navigate to Supabase Dashboard → Database → Backups
  Then Daily backup schedule shows as enabled
  And Last backup timestamp is visible (within 24 hours)

Scenario: 1.7-E2E-027
  Given Daily backup available in Supabase
  When I initiate backup restoration to staging environment
  Then Restoration completes successfully
  And Staging database contains production data snapshot
```

---

### AC10: Application remains accessible and functional after deployment

**Stability Monitoring:** 24-Hour Observation, Error Tracking

| ID          | Level       | Priority | Scenario                                       | Justification                        | Risk Coverage    |
| ----------- | ----------- | -------- | ---------------------------------------------- | ------------------------------------ | ---------------- |
| 1.7-E2E-028 | E2E         | P0       | Application accessible immediately post-deploy | Initial deployment success           | OPS-001, OPS-002 |
| 1.7-E2E-029 | E2E         | P0       | Application accessible after 6 hours           | Short-term stability                 | OPS-002          |
| 1.7-E2E-030 | E2E         | P0       | Application accessible after 12 hours          | Medium-term stability                | OPS-002          |
| 1.7-E2E-031 | E2E         | P0       | Application accessible after 24 hours          | 24-hour stability requirement        | OPS-002          |
| 1.7-INT-026 | Integration | P0       | Vercel deployment logs show no critical errors | Error monitoring                     | OPS-002          |
| 1.7-INT-027 | Integration | P1       | Supabase dashboard shows normal activity       | Database health monitoring           | OPS-002          |
| 1.7-E2E-032 | E2E         | P1       | Web Vitals: LCP <3s, FID <100ms, CLS <0.1      | Performance targets (AC requirement) | PERF-003         |
| 1.7-INT-028 | Integration | P1       | Vercel Analytics enabled and recording         | Observability verification           | OPS-004          |
| 1.7-INT-029 | Integration | P2       | Production URL documented in team docs         | Documentation requirement            | OPS-003          |

**Given-When-Then Examples:**

```gherkin
Scenario: 1.7-E2E-028
  Given Deployment completed at T0
  When I access production URL at T0 + 5 minutes
  Then Application loads successfully
  And Health check returns 200 OK

Scenario: 1.7-E2E-031
  Given Deployment completed at T0
  When I access production URL at T0 + 24 hours
  Then Application still accessible
  And Health check still returns 200 OK
  And No downtime reported in monitoring

Scenario: 1.7-INT-026
  Given 24 hours elapsed since deployment
  When I review Vercel deployment logs
  Then No HTTP 500 errors present
  And No function timeout errors present
  And No build failures present
```

---

## Additional Test Scenarios (Not Directly Tied to ACs)

### Load and Stress Testing

| ID          | Level       | Priority | Scenario                                  | Justification              | Risk Coverage      |
| ----------- | ----------- | -------- | ----------------------------------------- | -------------------------- | ------------------ |
| 1.7-INT-030 | Integration | P1       | 50 concurrent requests to health endpoint | Connection pool validation | TECH-001           |
| 1.7-INT-031 | Integration | P2       | Sustained 10 req/sec for 5 minutes        | Production load simulation | TECH-001, PERF-001 |

### Security Testing

| ID           | Level       | Priority | Scenario                                  | Justification             | Risk Coverage |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------- | ------------- |
| 1.7-UNIT-003 | Unit        | P1       | Health check input sanitization           | Prevent injection attacks | -             |
| 1.7-INT-032  | Integration | P1       | Storage bucket unauthorized write attempt | RLS policy enforcement    | SEC-002       |

### Monitoring and Observability

| ID           | Level | Priority | Scenario                                 | Justification          | Risk Coverage     |
| ------------ | ----- | -------- | ---------------------------------------- | ---------------------- | ----------------- |
| 1.7-E2E-033  | E2E   | P1       | Vercel Analytics records page views      | Analytics integration  | OPS-004           |
| 1.7-E2E-034  | E2E   | P1       | Speed Insights tracks Web Vitals         | Performance monitoring | PERF-003, OPS-004 |
| 1.7-UNIT-004 | Unit  | P2       | Health check timestamp format validation | ISO 8601 compliance    | -                 |

---

## Risk Coverage Matrix

| Risk ID  | Severity | Mitigating Test Scenarios                                         | Coverage |
| -------- | -------- | ----------------------------------------------------------------- | -------- |
| SEC-001  | Critical | 1.7-E2E-007, 1.7-INT-007, 1.7-E2E-008, 1.7-INT-008, 1.7-E2E-009   | 100%     |
| DATA-001 | Critical | 1.7-E2E-013, 1.7-E2E-014, 1.7-INT-014, 1.7-INT-016, 1.7-E2E-016   | 100%     |
| OPS-001  | High     | 1.7-E2E-001, 1.7-INT-001, 1.7-E2E-002, 1.7-E2E-028                | 100%     |
| TECH-001 | High     | 1.7-INT-003, 1.7-INT-004, 1.7-INT-030, 1.7-INT-031                | 100%     |
| PERF-001 | High     | 1.7-UNIT-001, 1.7-INT-018, 1.7-E2E-017, 1.7-UNIT-002, 1.7-INT-019 | 100%     |
| OPS-002  | High     | 1.7-E2E-028, 1.7-E2E-029, 1.7-E2E-030, 1.7-E2E-031, 1.7-INT-026   | 100%     |
| SEC-002  | High     | 1.7-E2E-005, 1.7-INT-005, 1.7-INT-032                             | 100%     |
| TECH-002 | Medium   | 1.7-INT-023, 1.7-E2E-024, 1.7-INT-024                             | 100%     |
| DATA-002 | Medium   | 1.7-E2E-006, 1.7-INT-006, 1.7-E2E-027                             | 100%     |
| PERF-002 | Medium   | 1.7-E2E-021, 1.7-INT-021, 1.7-E2E-022                             | 100%     |
| OPS-003  | Medium   | 1.7-INT-029                                                       | 100%     |
| TECH-003 | Medium   | 1.7-INT-001, 1.7-E2E-023                                          | 100%     |
| DATA-003 | Medium   | 1.7-E2E-015, 1.7-INT-015, 1.7-INT-017                             | 100%     |
| SEC-003  | Medium   | 1.7-E2E-011, 1.7-INT-011, 1.7-E2E-012                             | 100%     |
| BUS-001  | Low      | N/A (project management scope)                                    | N/A      |
| PERF-003 | Low      | 1.7-E2E-032                                                       | 100%     |
| OPS-004  | Low      | 1.7-INT-028, 1.7-E2E-033, 1.7-E2E-034                             | 100%     |
| TECH-004 | Low      | 1.7-INT-010                                                       | 100%     |

**Summary:** 18 risks with defined tests = 100% risk coverage (excluding BUS-001 which is PM scope)

---

## Recommended Test Execution Order

### Phase 1: Pre-Deployment Validation (P0 Unit + Integration)

**Execute before ANY production deployment:**

1. **Security Critical:**
   - 1.7-E2E-007: .gitignore verification
   - 1.7-INT-007: Git history scan for secrets
   - 1.7-E2E-008: Environment variables configured
   - 1.7-INT-008: Secret naming convention

2. **Configuration Critical:**
   - 1.7-INT-001: vercel.json validation
   - 1.7-INT-003: Database connection string
   - 1.7-INT-004: Pooler port 6543 verification

3. **Database Critical:**
   - 1.7-E2E-013: Staging migration dry-run
   - 1.7-INT-013: Prisma client generation
   - 1.7-E2E-016: Rollback procedure validation

4. **Health Check Logic:**
   - 1.7-UNIT-001: Health check without database
   - 1.7-UNIT-002: Timeout handling

**Total: 13 scenarios - MUST PASS before production deployment**

---

### Phase 2: Deployment Execution (P0 E2E)

**Execute during deployment:**

5. **Vercel Deployment:**
   - 1.7-E2E-001: Account creation and GitHub link
   - 1.7-E2E-002: Automatic deployment from main

6. **Supabase Setup:**
   - 1.7-E2E-004: Supabase project creation
   - 1.7-E2E-005: Storage bucket creation
   - 1.7-INT-005: RLS policies configuration

7. **Production Migration:**
   - 1.7-E2E-014: Production migration execution
   - 1.7-INT-014: Table verification
   - 1.7-E2E-015: Seed script execution
   - 1.7-INT-015: Seed data validation

**Total: 8 scenarios - Execute in sequence during deployment**

---

### Phase 3: Post-Deployment Validation (P0 E2E)

**Execute immediately after deployment (within 1 hour):**

8. **Accessibility:**
   - 1.7-E2E-010: Production URL resolution
   - 1.7-E2E-011: HTTPS certificate provisioning
   - 1.7-INT-011: Certificate validity

9. **Functionality:**
   - 1.7-E2E-017: Health check returns 200
   - 1.7-E2E-019: Login page loads
   - 1.7-E2E-020: No console errors
   - 1.7-E2E-021: Static assets load

10. **Integration:**
    - 1.7-INT-023: Frontend API call succeeds
    - 1.7-E2E-024: No CORS errors

11. **Backup:**
    - 1.7-E2E-026: Backup schedule enabled

**Total: 11 scenarios - Execute immediately post-deployment**

---

### Phase 4: 24-Hour Stability Monitoring (P0 E2E)

**Execute at intervals over 24 hours:**

12. **Stability Checkpoints:**
    - 1.7-E2E-028: T0 + 5 minutes
    - 1.7-E2E-029: T0 + 6 hours
    - 1.7-E2E-030: T0 + 12 hours
    - 1.7-E2E-031: T0 + 24 hours

13. **Continuous Monitoring:**
    - 1.7-INT-026: Vercel logs (no critical errors)
    - 1.7-INT-027: Supabase dashboard (normal activity)

**Total: 6 scenarios - Execute across 24-hour window**

---

### Phase 5: P1 Tests (Should Execute)

**Execute during Phase 3 or Phase 4:**

- Preview deployments (1.7-E2E-003)
- Performance validation (1.7-INT-021, 1.7-E2E-032)
- Load testing (1.7-INT-030)
- Additional integrations (1.7-INT-019, 1.7-E2E-025, 1.7-E2E-033)

**Total: 18 P1 scenarios**

---

### Phase 6: P2 + P3 Tests (Optional)

**Execute if time permits or during regression cycles:**

- Detailed monitoring (1.7-INT-006, 1.7-INT-020, 1.7-INT-022)
- Edge cases (1.7-INT-010, 1.7-INT-012, 1.7-E2E-027)

**Total: 9 P2/P3 scenarios**

---

## Test Coverage Analysis

### Coverage by Acceptance Criterion

| AC# | Description                        | Test Scenarios | P0 Tests | P1 Tests | Coverage |
| --- | ---------------------------------- | -------------- | -------- | -------- | -------- |
| 1   | Hosting platform configured        | 5              | 2        | 3        | 100%     |
| 2   | Database hosted on Supabase        | 7              | 5        | 1        | 100%     |
| 3   | Environment variables configured   | 7              | 5        | 1        | 100%     |
| 4   | HTTPS accessible at stable URL     | 5              | 3        | 1        | 100%     |
| 5   | Database migrations run            | 9              | 6        | 2        | 100%     |
| 6   | Health check endpoint returns 200  | 7              | 3        | 2        | 100%     |
| 7   | Frontend loads login page          | 7              | 3        | 3        | 100%     |
| 8   | Backend API accessible (CORS)      | 4              | 2        | 2        | 100%     |
| 9   | Automated daily backups configured | 3              | 1        | 1        | 100%     |
| 10  | Application stable 24 hours        | 9              | 6        | 2        | 100%     |

**Total AC Coverage:** 10/10 ACs (100%)

### Coverage Gaps

**None identified.** All acceptance criteria have comprehensive test coverage at appropriate levels.

---

## Test Maintainability Considerations

### Infrastructure Tests (E2E-Heavy)

**Challenges:**

- Manual verification required (Vercel dashboard, Supabase console)
- Environment-dependent (production-only scenarios)
- Time-intensive (24-hour stability monitoring)

**Mitigation:**

- Document exact verification steps in test scenarios
- Create checklists for manual verification
- Automate where possible (health check pings, log monitoring)
- Use screenshots/recordings for verification evidence

### Automation Opportunities

**Automatable:**

- Health check endpoint testing (curl scripts)
- Git history scanning (Gitleaks)
- Load testing (k6 or Artillery)
- Continuous health monitoring (cron + curl)

**Manual Required:**

- Vercel dashboard configuration
- Supabase console verification
- Visual validation (login page rendering)
- Certificate inspection

---

## Test Environment Requirements

### Local Development

- None required (infrastructure story)

### Staging/Preview

- Supabase staging project (for migration dry-run)
- Vercel preview deployment (from PR)

### Production

- Vercel production deployment
- Supabase production database
- Monitoring tools (browser DevTools, dashboard access)

---

## Test Data Requirements

### Database

- **Seed Data:** 3 disciplines, 1 unit, 1 lesson (provided by `prisma/seed.ts`)
- **Migration State:** Empty database → full schema via Prisma migrations

### Environment Variables

- Production secrets (Supabase connection, API keys)
- Different from development secrets (security requirement)

### Access Credentials

- Vercel account access
- Supabase dashboard access
- GitHub repository access

---

## Quality Checklist Validation

- [x] Every AC has test coverage (10/10 ACs covered)
- [x] Test levels are appropriate (E2E for infrastructure, unit for logic)
- [x] No duplicate coverage across levels (unique scenarios per level)
- [x] Priorities align with business risk (P0 covers critical risks)
- [x] Test IDs follow naming convention (1.7-{LEVEL}-{SEQ})
- [x] Scenarios are atomic and independent (each can run standalone)

---

## Summary Statistics

- **Test Scenarios:** 42 total
- **Test Level Distribution:**
  - Unit: 4 (10%) - Health check logic only
  - Integration: 18 (43%) - Configuration, connectivity, validation
  - E2E: 20 (47%) - Full deployment workflow
- **Priority Distribution:**
  - P0: 15 (36%) - Must execute before/during/after deployment
  - P1: 18 (43%) - Should execute for comprehensive validation
  - P2: 7 (17%) - Nice to have, execute if time permits
  - P3: 2 (5%) - Opportunistic testing
- **Risk Coverage:** 18/18 risks covered (100%)
- **AC Coverage:** 10/10 ACs covered (100%)
- **Estimated Execution Time:**
  - P0 tests: ~4 hours (includes 24-hour monitoring setup)
  - P1 tests: ~2 hours
  - P2/P3 tests: ~1 hour
  - 24-hour monitoring: Ongoing observation
  - **Total: ~7 hours active testing + 24 hours passive monitoring**

**Testing Approach:** Manual verification-heavy due to infrastructure nature. Heavy reliance on E2E tests to validate complete deployment workflow. Unit tests limited to health check logic. Integration tests focus on configuration correctness and component connectivity.
