# Test Design: Story 1.4 - Frontend Application Foundation

**Date**: 2025-10-03
**Designer**: Quinn (Test Architect)

## Test Strategy Overview

- **Total test scenarios**: 24
- **Unit tests**: 8 (33%)
- **Integration tests**: 12 (50%)
- **E2E tests**: 4 (17%)
- **Priority distribution**: P0: 8, P1: 12, P2: 4

**Test Pyramid Health**: ✅ Healthy distribution (unit-heavy base, integration middle, E2E top)

---

## Test Scenarios by Acceptance Criteria

### AC1: Frontend framework initialized based on tech stack

#### Scenarios

| ID          | Level       | Priority | Test                                       | Justification               | Mitigates Risk |
| ----------- | ----------- | -------- | ------------------------------------------ | --------------------------- | -------------- |
| 1.4-INT-001 | Integration | P1       | Verify Next.js 14.x with App Router loaded | Framework presence critical | TECH-001       |
| 1.4-INT-002 | Integration | P1       | Validate TypeScript 5.x compiles           | Type safety foundation      | TECH-001       |

**Coverage**: Framework initialization validated at integration level (can't unit test framework itself)

---

### AC2: Development server starts with hot-reloading enabled

#### Scenarios

| ID          | Level       | Priority | Test                                    | Justification                  | Mitigates Risk |
| ----------- | ----------- | -------- | --------------------------------------- | ------------------------------ | -------------- |
| 1.4-INT-003 | Integration | P0       | `pnpm dev` starts both frontend and API | Critical dev workflow          | OPS-001        |
| 1.4-INT-004 | Integration | P1       | Hot-reload updates component on change  | Developer productivity feature | TECH-001       |

**Coverage**: Server startup is P0 (blocks all development), hot-reload is P1 (productivity feature)

---

### AC3: Basic routing configured with at least home route (/)

#### Scenarios

| ID          | Level       | Priority | Test                             | Justification              | Mitigates Risk |
| ----------- | ----------- | -------- | -------------------------------- | -------------------------- | -------------- |
| 1.4-INT-005 | Integration | P0       | Navigate to "/" renders HomePage | Core routing functionality | TECH-001       |
| 1.4-E2E-001 | E2E         | P1       | Browser displays home page       | User-facing critical path  | TECH-001       |

**Coverage**: Integration tests routing logic, E2E validates browser accessibility

---

### AC4: Base application layout with header/main/footer placeholders

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification                   | Mitigates Risk |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------------- | -------------- |
| 1.4-UNIT-001 | Unit        | P1       | RootLayout renders children prop          | Pure component logic            | -              |
| 1.4-INT-006  | Integration | P0       | RootLayout includes Header/Main/Footer    | Layout structure validation     | -              |
| 1.4-INT-007  | Integration | P0       | Providers (Chakra, Query) present in tree | Critical provider configuration | TECH-002       |

**Coverage**: Unit test for component logic, integration tests for structure and providers (HIGH RISK mitigation)

---

### AC5: Global styling foundation established (CSS reset, typography, color variables)

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification                  | Mitigates Risk |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------------ | -------------- |
| 1.4-INT-008  | Integration | P1       | globals.css imports and applies CSS reset | Baseline styling foundation    | TECH-003       |
| 1.4-INT-009  | Integration | P1       | Chakra theme with custom colors applies   | Theme customization validation | TECH-003       |
| 1.4-UNIT-002 | Unit        | P2       | Theme object has required color variables | Theme structure correctness    | -              |

**Coverage**: Integration tests visual rendering, unit test validates theme configuration object

---

### AC6: API client utility configured with error handling

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification              | Mitigates Risk |
| ------------ | ----------- | -------- | ----------------------------------------- | -------------------------- | -------------- |
| 1.4-UNIT-003 | Unit        | P0       | apiClient handles network errors          | Critical error handling    | TECH-004       |
| 1.4-UNIT-004 | Unit        | P0       | apiClient handles 4xx response errors     | HTTP client error handling | TECH-004       |
| 1.4-UNIT-005 | Unit        | P0       | apiClient handles 5xx server errors       | Server error handling      | TECH-004       |
| 1.4-UNIT-006 | Unit        | P1       | apiClient parses JSON responses correctly | Data transformation logic  | TECH-004       |
| 1.4-INT-010  | Integration | P1       | useHealthCheck hook fetches /api/health   | TanStack Query integration | -              |

**Coverage**: Comprehensive error handling at unit level (fast feedback), integration validates real hook behavior

---

### AC7: Environment variable support for API base URL

#### Scenarios

| ID           | Level       | Priority | Test                                          | Justification                  | Mitigates Risk |
| ------------ | ----------- | -------- | --------------------------------------------- | ------------------------------ | -------------- |
| 1.4-UNIT-007 | Unit        | P0       | API client reads NEXT_PUBLIC_APP_URL          | Environment config correctness | DATA-001       |
| 1.4-INT-011  | Integration | P1       | API client works with different base URLs     | Multi-environment support      | DATA-001       |
| 1.4-E2E-002  | E2E         | P2       | .env.example documents all required variables | Developer onboarding           | DATA-001       |

**Coverage**: Unit test ensures environment reading, integration tests runtime behavior, E2E validates documentation

---

### AC8: Frontend starts locally with single command (npm run dev:frontend)

#### Scenarios

| ID          | Level       | Priority | Test                                    | Justification              | Mitigates Risk |
| ----------- | ----------- | -------- | --------------------------------------- | -------------------------- | -------------- |
| 1.4-INT-003 | Integration | P0       | (Reused) `pnpm dev` starts successfully | Single command requirement | OPS-001        |

**Coverage**: Reuses INT-003 from AC2 (no duplicate test needed)

---

### AC9: Application renders in browser at localhost with welcome content

#### Scenarios

| ID           | Level       | Priority | Test                                         | Justification                  | Mitigates Risk     |
| ------------ | ----------- | -------- | -------------------------------------------- | ------------------------------ | ------------------ |
| 1.4-E2E-001  | E2E         | P1       | (Reused) Browser displays home page          | User-facing validation         | -                  |
| 1.4-E2E-003  | E2E         | P1       | Welcome message visible in browser           | Critical user content          | -                  |
| 1.4-UNIT-008 | Unit        | P1       | HomePage component renders welcome message   | Component content logic        | -                  |
| 1.4-INT-012  | Integration | P0       | Application renders without hydration errors | Server/client boundary correct | TECH-001, TECH-002 |
| 1.4-E2E-004  | E2E         | P2       | React Query DevTools visible in dev mode     | Developer tooling validation   | PERF-001           |

**Coverage**: Unit tests component logic, integration tests hydration (critical!), E2E validates browser rendering

---

## Test Scenarios Summary Table

### Unit Tests (8 scenarios)

| ID           | Priority | Component  | Test Focus                   |
| ------------ | -------- | ---------- | ---------------------------- |
| 1.4-UNIT-001 | P1       | RootLayout | Children prop rendering      |
| 1.4-UNIT-002 | P2       | Theme      | Color variables structure    |
| 1.4-UNIT-003 | P0       | API Client | Network error handling       |
| 1.4-UNIT-004 | P0       | API Client | 4xx error handling           |
| 1.4-UNIT-005 | P0       | API Client | 5xx error handling           |
| 1.4-UNIT-006 | P1       | API Client | JSON parsing                 |
| 1.4-UNIT-007 | P0       | API Client | Environment variable reading |
| 1.4-UNIT-008 | P1       | HomePage   | Welcome message rendering    |

### Integration Tests (12 scenarios)

| ID          | Priority | Component  | Test Focus                     |
| ----------- | -------- | ---------- | ------------------------------ |
| 1.4-INT-001 | P1       | Framework  | Next.js 14.x App Router        |
| 1.4-INT-002 | P1       | Framework  | TypeScript 5.x compilation     |
| 1.4-INT-003 | P0       | Dev Server | `pnpm dev` starts both servers |
| 1.4-INT-004 | P1       | Dev Server | Hot-reload functionality       |
| 1.4-INT-005 | P0       | Routing    | Home route navigation          |
| 1.4-INT-006 | P0       | Layout     | Header/Main/Footer structure   |
| 1.4-INT-007 | P0       | Providers  | Chakra + Query providers       |
| 1.4-INT-008 | P1       | Styling    | CSS reset application          |
| 1.4-INT-009 | P1       | Styling    | Chakra theme application       |
| 1.4-INT-010 | P1       | API Hooks  | useHealthCheck hook            |
| 1.4-INT-011 | P1       | API Client | Multi-environment URLs         |
| 1.4-INT-012 | P0       | Hydration  | No hydration errors            |

### E2E Tests (4 scenarios)

| ID          | Priority | Journey           | Test Focus              |
| ----------- | -------- | ----------------- | ----------------------- |
| 1.4-E2E-001 | P1       | Browser Rendering | Home page displays      |
| 1.4-E2E-002 | P2       | Documentation     | .env.example complete   |
| 1.4-E2E-003 | P1       | User Content      | Welcome message visible |
| 1.4-E2E-004 | P2       | Developer Tools   | DevTools visible in dev |

---

## Risk Coverage Mapping

| Risk ID  | Risk Description                      | Test Scenarios Mitigating              |
| -------- | ------------------------------------- | -------------------------------------- |
| TECH-001 | Next.js App Router complexity         | INT-001, INT-004, INT-005, INT-012     |
| TECH-002 | Provider nesting/client boundaries    | INT-007, INT-012                       |
| TECH-003 | CSS reset and theme conflicts         | INT-008, INT-009                       |
| TECH-004 | API client error handling gaps        | UNIT-003, UNIT-004, UNIT-005, UNIT-006 |
| DATA-001 | Environment variable exposure         | UNIT-007, INT-011, E2E-002             |
| PERF-001 | TanStack Query config overhead        | E2E-004                                |
| OPS-001  | Development server startup complexity | INT-003                                |

**Risk Coverage**: ✅ All 7 identified risks have dedicated test scenarios

---

## Test Execution Strategy

### Phase 1: P0 Unit Tests (Fast Fail) - ~5 minutes

Run first for immediate feedback on critical logic:

1. 1.4-UNIT-003: API client network error handling
2. 1.4-UNIT-004: API client 4xx error handling
3. 1.4-UNIT-005: API client 5xx error handling
4. 1.4-UNIT-007: Environment variable reading

**Exit Criteria**: All P0 unit tests pass before proceeding

---

### Phase 2: P0 Integration Tests (Critical Paths) - ~15 minutes

Validate critical integration points:

1. 1.4-INT-003: Dev server startup (`pnpm dev`)
2. 1.4-INT-005: Home route navigation
3. 1.4-INT-006: Layout structure (Header/Main/Footer)
4. 1.4-INT-007: Provider configuration ⚠️ **HIGH RISK**
5. 1.4-INT-012: No hydration errors ⚠️ **HIGH RISK**

**Exit Criteria**: All P0 integration tests pass, especially provider tests

---

### Phase 3: P1 Tests (Core Functionality) - ~20 minutes

Validate core functionality and user experience:

- **Unit**: 1.4-UNIT-001, UNIT-006, UNIT-008
- **Integration**: 1.4-INT-001, INT-002, INT-004, INT-008, INT-009, INT-010, INT-011
- **E2E**: 1.4-E2E-001, E2E-003

**Exit Criteria**: >90% P1 tests passing

---

### Phase 4: P2 Tests (Nice-to-Have) - ~10 minutes

Secondary features and documentation validation:

- **Unit**: 1.4-UNIT-002
- **E2E**: 1.4-E2E-002, E2E-004

**Exit Criteria**: Best effort, can defer if time-constrained

---

## Coverage Validation

### Requirements Coverage

✅ **All 9 Acceptance Criteria have test coverage**

- AC1: 2 tests
- AC2: 2 tests
- AC3: 2 tests
- AC4: 3 tests
- AC5: 3 tests
- AC6: 5 tests
- AC7: 3 tests
- AC8: Reused from AC2
- AC9: 5 tests

### No Duplicate Coverage

✅ **Each test targets unique aspect**:

- Unit tests: Business logic and pure functions
- Integration tests: Component interactions and rendering
- E2E tests: Browser-level user experience

### Test Pyramid Compliance

✅ **Healthy pyramid distribution**:

- Base (Unit): 33% - Good coverage of pure logic
- Middle (Integration): 50% - Appropriate for component-heavy story
- Top (E2E): 17% - Minimal but sufficient for critical paths

---

## Test Data Requirements

### Unit Tests

- **Mock API responses**: Success, network error, 4xx, 5xx, malformed JSON
- **Mock environment variables**: Different NEXT_PUBLIC_APP_URL values
- **Mock theme configuration**: Color palette, typography scales

### Integration Tests

- **Test database**: Not needed (Story 1.4 is frontend-only)
- **Test server**: Next.js dev server (real, not mocked)
- **Test components**: Real React components with providers

### E2E Tests

- **Browser environment**: Chromium or WebKit
- **Localhost server**: Running on port 3000
- **Environment files**: .env.example with documented variables

---

## Test Maintenance Considerations

### High Maintenance Risk

- **E2E tests**: Brittle if UI changes frequently (acceptable for foundation story)
- **Integration tests**: May break with Next.js upgrades

### Low Maintenance Risk

- **Unit tests**: Stable as long as business logic unchanged
- **API client tests**: Stable error handling patterns

### Maintenance Strategy

- Keep E2E tests minimal (4 scenarios only)
- Favor unit tests for logic that can be isolated
- Use data-testid attributes for E2E stability
- Abstract common test utilities (API client mocks, provider wrappers)

---

## Test Tools and Frameworks

**Per architecture/testing-strategy.md**:

- **Unit Testing**: Vitest 1.x (fast, ESM-native)
- **Component Testing**: React Testing Library 14.x (accessibility-focused)
- **E2E Testing**: Playwright or Cypress (browser automation)
- **Coverage Goal**: 70%+ for React components

**Test Commands**:

```bash
pnpm test              # Run all tests
pnpm test --watch      # Watch mode for development
pnpm test --coverage   # Generate coverage report
pnpm test:e2e          # Run E2E tests only
```

---

## Success Criteria

### Definition of Done

- ✅ All P0 tests pass (8 scenarios)
- ✅ All P1 tests pass (12 scenarios)
- ✅ Component test coverage ≥70%
- ✅ All identified risks have test coverage
- ✅ No hydration errors in integration tests
- ✅ Provider configuration validated

### Optional (P2)

- P2 tests pass (4 scenarios)
- Manual visual testing complete
- Documentation reviewed

---

## Quality Checklist

Before finalizing Story 1.4:

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention (1.4-{LEVEL}-{SEQ})
- [x] Scenarios are atomic and independent
- [x] All HIGH and MEDIUM risks mitigated with tests
- [x] Test execution order optimized for fast feedback

---

## Appendix: Test Scenario Details

### Example: 1.4-INT-007 (Provider Configuration - HIGH RISK)

```typescript
// app/layout.test.tsx
import { render, screen } from '@testing-library/react';
import RootLayout from './layout';

describe('RootLayout - Provider Configuration', () => {
  it('should include ChakraProvider in component tree', () => {
    const { container } = render(
      <RootLayout>
        <div>Test Content</div>
      </RootLayout>
    );

    // Validate ChakraProvider is present
    const chakraProvider = container.querySelector('[data-chakra-provider]');
    expect(chakraProvider).toBeInTheDocument();
  });

  it('should include QueryClientProvider in component tree', () => {
    const { container } = render(
      <RootLayout>
        <div>Test Content</div>
      </RootLayout>
    );

    // Validate QueryClientProvider is present
    // (React Query adds specific attributes to the tree)
    expect(container.querySelector('[data-query-client-provider]')).toBeInTheDocument();
  });
});
```

### Example: 1.4-UNIT-003 (API Client Error Handling - P0)

```typescript
// lib/api/client.test.ts
import { apiClient } from './client';

describe('apiClient - Error Handling', () => {
  it('should handle network errors gracefully', async () => {
    // Mock network failure
    global.fetch = vi.fn(() => Promise.reject(new TypeError('Network error')));

    await expect(apiClient('/api/test')).rejects.toThrow('Network error');
  });

  it('should handle 4xx errors with error message extraction', async () => {
    global.fetch = vi.fn(() =>
      Promise.resolve({
        ok: false,
        status: 400,
        json: () => Promise.resolve({ message: 'Bad Request' }),
      })
    );

    await expect(apiClient('/api/test')).rejects.toThrow('Bad Request');
  });
});
```

---

**Document Version**: 1.0
**Last Updated**: 2025-10-03
**Next Review**: After Story 1.4 implementation
